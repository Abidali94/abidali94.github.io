<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ğŸ“¦ KharchaSaathi â€” Business Dashboard v5.4</title>
<meta name="theme-color" content="#ff7a00">
<style>
:root{
  --orange:#ff7a00; --orange-dark:#cc6300;
  --bg:#f8f9fa; --card:#fff; --text:#222;
  --dark-bg:#121212; --dark-card:#1e1e1e; --muted:#666;
}
*{box-sizing:border-box}
body{font-family:Poppins,Arial,sans-serif;margin:0;padding:18px;background:var(--bg);color:var(--text);transition:background .3s,color .3s;}
body.dark{background:var(--dark-bg);color:#e8e8e8}
h1{margin:0 0 14px;color:var(--orange);font-size:20px}
.topbar{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;gap:12px}
.controls{display:flex;gap:8px;align-items:center}
.theme-btn,.small-btn{background:var(--orange);color:#fff;border:none;padding:8px 10px;border-radius:8px;cursor:pointer}
.theme-btn:hover{background:var(--orange-dark)}
.tabs{display:flex;gap:8px;margin:18px 0;flex-wrap:wrap;justify-content:center}
.tab{background:#eee;padding:8px 12px;border-radius:10px;cursor:pointer;font-weight:600}
body.dark .tab{background:#2b2b2b}
.tab.active{background:var(--orange);color:#fff}
.section{display:none;background:var(--card);padding:14px;border-radius:12px;box-shadow:0 6px 20px rgba(0,0,0,.06);margin-bottom:18px}
body.dark .section{background:var(--dark-card);box-shadow:none}
.section.active{display:block}
.row{display:flex;gap:8px;align-items:center;flex-wrap:wrap}
input,select{padding:8px;border-radius:8px;border:1px solid #ccc;min-width:140px}
body.dark input,body.dark select{background:#222;border-color:#333;color:#e8e8e8}
table{width:100%;border-collapse:collapse;margin-top:12px}
th,td{padding:8px;border:1px solid #eee;text-align:center;font-size:13px}
body.dark th,body.dark td{border-color:#333}
th{background:var(--orange);color:#fff}
.sell-btn{background:#00a86b;color:#fff;border:none;padding:5px 8px;border-radius:6px;cursor:pointer}
.sell-btn:hover{background:#007c50}
.footer-btns{text-align:center;margin-top:20px}
.footer-btns a{background:var(--orange);color:#fff;padding:10px 16px;border-radius:8px;text-decoration:none;margin:6px;display:inline-block}
.footer-btns a:hover{background:var(--orange-dark)}
.credit-btn{background:#007bff;color:#fff;border:none;padding:5px 8px;border-radius:6px;cursor:pointer}
.credit-btn:hover{background:#0056b3}
#helpModal{display:none;position:fixed;inset:0;background:rgba(0,0,0,0.6);justify-content:center;align-items:center;z-index:9999}
.help-box{background:var(--card);color:var(--text);max-width:700px;width:90%;padding:18px;border-radius:12px;overflow-y:auto;max-height:85vh;}
body.dark .help-box{background:var(--dark-card);color:#e8e8e8}
.help-box h2{color:var(--orange)}
.close-btn{background:var(--orange);color:#fff;border:none;padding:6px 10px;border-radius:6px;float:right;cursor:pointer}
.close-btn:hover{background:var(--orange-dark)}
@media(max-width:720px){.row{flex-direction:column;align-items:stretch}table td,table th{font-size:12px}}
</style>
</head>
<body>

<div class="topbar">
  <div>
    <h1>ğŸ“¦ KharchaSaathi â€” Business Dashboard v5.4</h1>
    <div class="muted">Offline â€¢ Auto-Sell â€¢ Credit Support</div>
  </div>
  <div class="controls">
    <button class="theme-btn" id="themeBtn">ğŸŒ™</button>
  </div>
</div>

<div class="tabs">
  <div class="tab active" data-tab="stock">ğŸ“¦ Stock</div>
  <div class="tab" data-tab="sales">ğŸ“ˆ Sales</div>
  <div class="tab" data-tab="wanting">ğŸ›’ Wanting</div>
</div>

<section id="stock" class="section active">
  <h3>ğŸ“¦ Current Stock</h3>
  <div class="row">
    <label>Filter:</label>
    <select id="viewTypeFilter" onchange="renderStock()"><option value="All">All</option></select>
  </div>
  <table id="stockTable">
    <thead><tr><th>Date</th><th>Type</th><th>Product</th><th>Qty</th><th>Sold</th><th>Remaining</th><th>Action</th></tr></thead>
    <tbody></tbody>
  </table>
</section>

<section id="sales" class="section">
  <h3>ğŸ’° Sales Ledger</h3>
  <table id="salesTable">
    <thead><tr><th>Date</th><th>Type</th><th>Product</th><th>Qty</th><th>Price â‚¹</th><th>Total â‚¹</th><th>Status</th><th>Action</th></tr></thead>
    <tbody></tbody>
    <tfoot><tr><td colspan="6" style="text-align:right;font-weight:bold;">Total:</td><td id="dayTotal">0</td><td></td></tr></tfoot>
  </table>
  <div class="row">
    <input type="date" id="sdate">
    <select id="stype"></select>
    <input type="text" id="sname" placeholder="Product name">
    <input type="number" id="sqty" placeholder="Qty">
    <input type="number" id="sprice" placeholder="Price â‚¹">
    <label><input type="checkbox" id="scredit"> Credit Sale</label>
    <button onclick="addSale()">Add Sale</button>
    <button class="small-btn" onclick="clearSales()">Clear All</button>
  </div>
</section>

<section id="wanting" class="section">
  <h3>ğŸ›’ Wanting List</h3>
  <div class="row">
    <input type="date" id="wdate">
    <select id="wtype"></select>
    <input type="text" id="witem" placeholder="Item name">
    <button onclick="addWant()">Add</button>
    <button onclick="printWanting()">ğŸ–¨ï¸ Print / PDF</button>
  </div>
</section>

<div class="footer-btns">
  <a href="#" onclick="openHelp()">ğŸ“˜ Help</a>
  <a href="../index.html">ğŸ  Back to Home</a>
</div>

<script>
const K_TYPES='item-types',K_STOCK='stock-data',K_SALES='sales-data',K_WANT='wanting-data';
let types=JSON.parse(localStorage.getItem(K_TYPES)||'[]'),
stock=JSON.parse(localStorage.getItem(K_STOCK)||'[]'),
sales=JSON.parse(localStorage.getItem(K_SALES)||'[]'),
want=JSON.parse(localStorage.getItem(K_WANT)||'[]');

function saveAll(){localStorage.setItem(K_STOCK,JSON.stringify(stock));
localStorage.setItem(K_SALES,JSON.stringify(sales));localStorage.setItem(K_WANT,JSON.stringify(want));}

function renderStock(){
const f=document.getElementById('viewTypeFilter').value,tb=document.querySelector('#stockTable tbody');
let d=f==="All"||!f?stock:stock.filter(s=>s.type===f);
tb.innerHTML=d.map(s=>{
const idx=stock.indexOf(s);
return `<tr><td>${s.date}</td><td>${s.type}</td><td>${s.name}</td><td>${s.qty}</td>
<td>${s.sold||0}</td><td>${s.qty-(s.sold||0)}</td>
<td><button class="sell-btn" onclick="sellFromStock(${idx})">ğŸ›’ Sell</button></td></tr>`}).join('');
}

function sellFromStock(i){
const item=stock[i];const remain=item.qty-(item.sold||0);
if(remain<=0)return alert("No stock left");
const qty=parseInt(prompt(`Sell quantity for ${item.name} (Available: ${remain})`));
if(!qty||qty<=0||qty>remain)return alert("Invalid quantity");
const price=parseFloat(prompt("Enter price per unit â‚¹"));
if(!price||price<=0)return;
const credit=confirm("Is this a Credit Sale?");
const date=new Date().toISOString().split('T')[0];
const amount=qty*price;
item.sold=(item.sold||0)+qty;
sales.push({type:item.type,product:item.name,qty,price,amount,date,status:credit?"Credit":"Paid"});
saveAll();renderStock();renderSales();
alert(credit?"ğŸ’³ Credit sale recorded!":"âœ… Cash sale recorded!");
}

function addSale(){
const type=document.getElementById('stype').value,
name=document.getElementById('sname').value.trim(),
qty=parseInt(document.getElementById('sqty').value),
price=parseFloat(document.getElementById('sprice').value),
date=document.getElementById('sdate').value,
isCredit=document.getElementById('scredit').checked;
if(!type||!name||!qty||!price||!date)return alert("Fill all fields");
sales.push({type,product:name,qty,price,amount:qty*price,date,status:isCredit?"Credit":"Paid"});
saveAll();renderSales();
['stype','sname','sqty','sprice','sdate','scredit'].forEach(id=>{const el=document.getElementById(id);if(el.type==='checkbox')el.checked=false;else el.value='';});
}

function markPaid(i){sales[i].status="Paid";saveAll();renderSales();}

function renderSales(){
const tb=document.querySelector('#salesTable tbody');let t=0;
tb.innerHTML=sales.map((s,i)=>{t+=s.amount;
return `<tr><td>${s.date}</td><td>${s.type}</td><td>${s.product}</td><td>${s.qty}</td>
<td>${s.price}</td><td>${s.amount}</td><td>${s.status}</td>
<td>${s.status==="Credit"?`<button class='credit-btn' onclick='markPaid(${i})'>Mark Paid</button>`:""}</td></tr>`;
}).join('');
document.getElementById('dayTotal').textContent=t.toFixed(2);
}

function clearSales(){if(confirm("Clear all sales?")){sales=[];saveAll();renderSales();}}

function openHelp(){alert("ğŸ’³ New feature: Credit sales added!\nUse the checkbox or 'Is this Credit Sale?' prompt.");}

function openTab(id){
document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
document.querySelectorAll('.section').forEach(s=>s.classList.remove('active'));
document.querySelector(`.tab[data-tab="${id}"]`).classList.add('active');
document.getElementById(id).classList.add('active');
}
document.querySelectorAll('.tab').forEach(tab=>tab.addEventListener('click',()=>openTab(tab.dataset.tab)));

renderStock();renderSales();
</script>
</body>
</html>
