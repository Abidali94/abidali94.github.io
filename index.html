<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ” KharchaSaathi â€” Login</title>
<meta name="theme-color" content="#ff7a00">
<style>
:root{
  --orange:#ff7a00; --orange-dark:#cc6300;
  --bg:#f5f6f7; --card:#fff; --text:#222;
  --dark-bg:#111; --dark-card:#1b1b1b; --dark-text:#eee; --dark-border:#333;
}
*{box-sizing:border-box;transition:.3s;}
body{
  font-family:'Poppins',Arial,sans-serif;
  margin:0; background:var(--bg); color:var(--text);
  display:flex; flex-direction:column; align-items:center; justify-content:center;
  height:100vh;
}
body.dark{background:var(--dark-bg);color:var(--dark-text);}
.card{
  background:var(--card);
  padding:28px 25px; border-radius:14px;
  box-shadow:0 6px 20px rgba(0,0,0,.1);
  width:90%; max-width:400px; text-align:center;
}
body.dark .card{background:var(--dark-card); border:1px solid var(--dark-border);}
h1{color:var(--orange); margin-bottom:6px;}
h3{margin-top:0;color:var(--text);}
body.dark h3{color:var(--dark-text);}
input{
  width:100%; padding:10px; margin:8px 0;
  border:1px solid #ccc; border-radius:6px; outline:none;
  font-size:14px;
}
body.dark input{background:#222;color:#fff;border:1px solid var(--dark-border);}
button{
  width:100%; padding:10px; margin-top:8px;
  background:var(--orange); color:#fff; border:none;
  border-radius:8px; cursor:pointer; font-weight:600;
}
button:hover{background:var(--orange-dark);}
.alt-links a{
  display:block; margin-top:12px; color:var(--orange); text-decoration:none;
}
.theme-toggle{
  position:fixed; top:14px; right:14px;
  background:var(--orange); color:#fff; border:none;
  padding:8px 10px; border-radius:8px; cursor:pointer;
}
.theme-toggle:hover{background:var(--orange-dark);}
</style>
</head>
<body>
<button class="theme-toggle" id="themeBtn">ğŸŒ™</button>

<div class="card">
  <h1>ğŸ“¦ KharchaSaathi</h1>
  <h3>Welcome Back</h3>
  <input type="email" id="email" placeholder="Email Address" required>
  <input type="password" id="password" placeholder="Password" required>
  <button id="loginBtn">ğŸ”“ Login</button>
  <button id="registerBtn">ğŸ“ Register</button>
  <button id="googleBtn">ğŸŸ¢ Continue with Google</button>
  <div class="alt-links">
    <a href="#" id="offlineBtn">ğŸ“´ Continue Offline</a>
  </div>
</div>

<script type="module">
// ğŸŒ™ Theme Toggle
if(localStorage.getItem('theme')==='true') document.body.classList.add('dark');
document.getElementById('themeBtn').onclick=()=>{
  document.body.classList.toggle('dark');
  localStorage.setItem('theme',document.body.classList.contains('dark'));
};

// ğŸ”¥ Firebase Auth Setup
import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signInWithPopup, GoogleAuthProvider } 
from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

const firebaseConfig = {
  apiKey: "AIzaSyC1TSwODhcD88-IizbteOGF-bbebAP6Poc",
  authDomain: "kharchasaathi-main.firebaseapp.com",
  projectId: "kharchasaathi-main",
  storageBucket: "kharchasaathi-main.firebasestorage.app",
  messagingSenderId: "116390837159",
  appId: "1:116390837159:web:6e3900fa3b25a07d4c9482",
  measurementId: "G-1M4H9VRSBY"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();
  // âœ… Login Function
document.getElementById("loginBtn").addEventListener("click", async ()=>{
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  if(!email || !password) return alert("âš ï¸ Please enter email and password.");

  try{
    await signInWithEmailAndPassword(auth, email, password);
    alert("âœ… Login successful!");
    window.location.href = "./pages/business-dashboard.html";
  }catch(error){
    alert("âŒ Login failed: " + error.message);
  }
});

// âœ… Register Function
document.getElementById("registerBtn").addEventListener("click", async ()=>{
  const email = document.getElementById("email").value.trim();
  const password = document.getElementById("password").value.trim();
  if(!email || !password) return alert("âš ï¸ Please enter email and password.");

  try{
    await createUserWithEmailAndPassword(auth, email, password);
    alert("ğŸ‰ Account created successfully!");
    window.location.href = "./pages/business-dashboard.html";
  }catch(error){
    alert("âŒ Registration failed: " + error.message);
  }
});

// âœ… Google Login Function
document.getElementById("googleBtn").addEventListener("click", async ()=>{
  try{
    await signInWithPopup(auth, provider);
    alert("âœ… Google login success!");
    window.location.href = "./pages/business-dashboard.html";
  }catch(error){
    alert("âŒ Google login failed: " + error.message);
  }
});

// ğŸ“´ Offline Mode
document.getElementById("offlineBtn").addEventListener("click", ()=>{
  alert("ğŸ“´ Working in Offline Mode â€” Data stored locally.");
  window.location.href = "./pages/business-dashboard.html";
});
  import { sendPasswordResetEmail, setPersistence, browserLocalPersistence } 
from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";

// ğŸ”„ Remember Session (Stay logged in)
setPersistence(auth, browserLocalPersistence)
  .then(() => console.log("âœ… Session persistence enabled"))
  .catch(err => console.warn("âš ï¸ Persistence error:", err.message));

// ğŸ” Forgot Password (Optional link could be added in UI)
const forgotLink = document.createElement("a");
forgotLink.textContent = "ğŸ”‘ Forgot Password?";
forgotLink.href = "#";
forgotLink.onclick = async ()=>{
  const email = prompt("Enter your registered email:");
  if(!email) return;
  try {
    await sendPasswordResetEmail(auth, email);
    alert("ğŸ“© Password reset link sent to your email!");
  } catch(err) {
    alert("âŒ Error: " + err.message);
  }
};
document.querySelector(".alt-links").appendChild(forgotLink);

// ğŸŒ“ Theme Memory Check
if(localStorage.getItem('theme')==='true') document.body.classList.add('dark');
  // ğŸŒ€ Add Loader Element
const loader = document.createElement("div");
loader.id = "loader";
loader.innerHTML = `<div class="spinner"></div><p>Loading...</p>`;
document.body.appendChild(loader);

// ğŸ’« Loader Styles
const style = document.createElement("style");
style.innerHTML = `
#loader {
  position: fixed;
  top:0; left:0; right:0; bottom:0;
  background: rgba(0,0,0,0.6);
  display:flex; flex-direction:column;
  justify-content:center; align-items:center;
  color:#fff; font-size:16px; z-index:9999;
  opacity:0; pointer-events:none;
  transition: opacity 0.3s ease;
}
#loader.show {opacity:1; pointer-events:all;}
.spinner {
  border: 4px solid rgba(255,255,255,0.2);
  border-top: 4px solid #ff7a00;
  border-radius: 50%;
  width: 40px; height: 40px;
  animation: spin 0.8s linear infinite;
}
@keyframes spin { 100% { transform: rotate(360deg); } }
`;
document.head.appendChild(style);

// ğŸ”„ Show Loader during Firebase operations
function showLoader(){ loader.classList.add("show"); }
function hideLoader(){ loader.classList.remove("show"); }

// Wrap auth actions with loader
async function safeAction(fn){
  try{
    showLoader();
    await fn();
  }catch(e){ console.error(e); alert(e.message);}
  finally{ hideLoader(); }
}

// Modify existing actions with loader
document.getElementById("loginBtn").onclick = ()=> safeAction(async ()=>{
  const email=document.getElementById("email").value.trim();
  const password=document.getElementById("password").value.trim();
  await signInWithEmailAndPassword(auth,email,password);
  window.location.href="./pages/business-dashboard.html";
});

document.getElementById("registerBtn").onclick = ()=> safeAction(async ()=>{
  const email=document.getElementById("email").value.trim();
  const password=document.getElementById("password").value.trim();
  await createUserWithEmailAndPassword(auth,email,password);
  window.location.href="./pages/business-dashboard.html";
});
  // âœ¨ Fade-in Transition for Page Load
document.body.style.opacity = 0;
window.addEventListener("load", () => {
  document.body.style.transition = "opacity 0.8s ease";
  document.body.style.opacity = 1;
});

// ğŸŒ™ Theme Button Enhancements
const themeBtn = document.getElementById("themeToggle");
if(themeBtn){
  themeBtn.onclick = () => {
    document.body.classList.toggle("dark");
    const dark = document.body.classList.contains("dark");
    localStorage.setItem("theme", dark);
    themeBtn.textContent = dark ? "â˜€ï¸" : "ğŸŒ™";
  };
}

// ğŸ§­ Smooth Scroll Links (optional enhancement)
document.querySelectorAll('a[href^="#"]').forEach(anchor=>{
  anchor.addEventListener('click', function(e){
    e.preventDefault();
    document.querySelector(this.getAttribute('href'))
      .scrollIntoView({behavior:'smooth'});
  });
});

// âœ… Page Ready
console.log("%cKharchaSaathi Index Page Loaded Successfully âœ¨","color:#ff7a00;font-weight:bold;");
  </script>
</body>
</html>
